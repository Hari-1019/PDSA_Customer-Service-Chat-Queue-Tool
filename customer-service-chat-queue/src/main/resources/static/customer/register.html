<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customer Registration</title>
    <link rel="stylesheet" href="../css/customer-style.css">
</head>
<body>
<h1>Customer Registration</h1>
<form id="registerForm">
    <input type="text" name="name" placeholder="Name" required>
    <input type="email" name="email" placeholder="Email" required>

    <select name="role" id="roleSelect" required>
        <option value="customer">Customer</option>
        <option value="agent">Agent</option>
        <option value="admin">Admin</option>
    </select>

    <div id="accountTypeContainer" style="display: none;">
        <label for="accountType">Account Type:</label>
        <select name="accountType" id="accountType">
            <option value="individual">Individual</option>
            <option value="enterprise">Enterprise</option>
        </select>
    </div>

    <input type="text" name="companyName" id="companyName" placeholder="Company Name" style="display: none;" value="">
    <input type="password" name="password" placeholder="Password" required>
    <button type="submit">Register</button>
    <button type="button" onclick="window.location.href='login.html'">Already have an account? Login</button>
</form>

<script>
    document.getElementById('roleSelect').addEventListener('change', function () {
        const accountTypeContainer = document.getElementById('accountTypeContainer');
        const companyNameField = document.getElementById('companyName');

        if (this.value === 'customer') {
            accountTypeContainer.style.display = 'block';
            companyNameField.style.display = 'block';
        } else {
            accountTypeContainer.style.display = 'none';
            companyNameField.style.display = 'none';
        }
    });

    document.getElementById('registerForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const formData = new FormData(e.target);
        const data = Object.fromEntries(formData.entries());

        try {
            const response = await fetch('http://localhost:8080/customer-service-chat-queue/api/auth/register', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data),
            });

            if (response.ok) {
                alert('Register Successful!');
                window.location.href = 'login.html';
            } else {
                const error = await response.text();
                alert(`Error: ${error}`);
            }
        } catch (err) {
            console.error(err);
            alert('An error occurred. Please try again.');
        }
    });
</script>
</body>
</html>